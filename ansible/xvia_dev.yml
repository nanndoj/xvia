---
# This playbook installs an X-Via environment to the defined host inventory from a remote package repository

- hosts: cs_servers
  become: yes
  become_user: root
  roles:
    - xvia-base
    - xvia-cs
  tags:
    - cs
  vars_files:
    - vars_files/local_repo.yml
    - vars_files/cs_database.yml
    - vars_files/xvia_remote_repo.yml

- hosts: cp_servers
  become: yes
  become_user: root
  roles:
    - xroad-cp
  tags:
    - cp
  vars_files:
    - vars_files/remote_repo.yml

- hosts: ss_servers
  become: yes
  become_user: root
  roles:
    - xvia-base
    - xvia-ss
    - soap-proxy
  tags:
    - ss
  vars_files:
    - vars_files/local_repo.yml
    - vars_files/ss_database.yml
    - vars_files/xvia_remote_repo.yml

- hosts: ca_servers
  become: yes
  become_user: root
  pre_tasks:
    - raw: apt install openssl
  roles:
    - role: xroad-ca
      tags: [ 'ca' ]
